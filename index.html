<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Magius - Sistema de Checklist de Inspe√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS externo -->
  <link rel="stylesheet" href="style.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
<div class="app-shell">
  <!-- MENU LATERAL -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon">M</div>
      <div class="sidebar-logo-text">
        <div class="sidebar-logo-main">MAGIUS</div>
        <div class="sidebar-logo-sub">Checklist</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <button class="sidebar-item active" onclick="selectSidebar('home')">
        <span class="sidebar-icon">üè†</span>
        <span class="sidebar-label">Checklist</span>
      </button>

      <button class="sidebar-item" onclick="selectSidebar('inspectors')">
        <span class="sidebar-icon">üë§</span>
        <span class="sidebar-label">Inspetores</span>
      </button>

      <button class="sidebar-item" onclick="selectSidebar('pieces')">
        <span class="sidebar-icon">üß©</span>
        <span class="sidebar-label">Pe√ßas & Itens</span>
      </button>

      <button class="sidebar-item" onclick="selectSidebar('dashboard')">
        <span class="sidebar-icon">üìä</span>
        <span class="sidebar-label">Dashboard</span>
      </button>

      <button class="sidebar-item" onclick="selectSidebar('reports')">
        <span class="sidebar-icon">üìë</span>
        <span class="sidebar-label">Relat√≥rios</span>
      </button>
    </nav>
  </aside>

  <!-- CONTE√öDO PRINCIPAL -->
  <div class="app-wrapper">
    <div class="container">

      <!-- Cabe√ßalho azul -->
      <div class="header">
        <div class="header-left">
          <div class="header-circles" aria-hidden="true">
            <span></span><span></span><span></span><span></span>
          </div>
          <div class="header-tagline">
            AJUDANDO A CONSTRUIR, CULTIVAR,<br>TRANSPORTAR E SEGUIR EM FRENTE
          </div>
        </div>
        <div class="header-brand">
          <div class="header-logo">MAGIUS</div>
          <div class="header-sub">METAL√öRGICA INDUSTRIAL</div>
        </div>
      </div>

      <!-- Barra de navega√ß√£o superior -->
      <div class="main-nav">
        <div class="nav-left">
          <button class="btn-home" onclick="selectSidebar('home')">In√≠cio</button>
        </div>
        <div class="nav-right" role="navigation" aria-label="Navega√ß√£o principal">
          <button class="nav-btn" onclick="selectSidebar('dashboard')">Dashboard</button>
          <button class="nav-btn admin" onclick="requestAdminAccess()">Admin</button>
        </div>
      </div>

      <!-- Tela HOME / sele√ß√£o de inspetor e pe√ßa -->
      <div id="home" class="screen active">
        <h2 class="page-title">MAGIUS - Sistema de Checklist de Inspe√ß√£o</h2>

        <div class="form-group">
          <label for="inspector">Inspetor:</label>
          <select id="inspector">
            <option value="" disabled selected>Selecionar inspetor</option>
          </select>
        </div>

        <div id="inspector-preview" class="inspector-preview">
          Nenhum inspetor selecionado.
        </div>

        <div class="form-group">
          <label for="piece">Pe√ßa:</label>
          <select id="piece">
            <option value="" disabled selected>Selecionar pe√ßa</option>
          </select>
        </div>

        <button class="btn-checklist" onclick="showChecklist()">Iniciar Checklist</button>
      </div>

      <!-- Tela do CHECKLIST da pe√ßa -->
      <div id="checklist" class="screen">
        <div class="checklist-layout">
          <div class="checklist-main">
            <div class="checklist-piece-title" id="checklist-header"></div>
            <div id="piece-image-box" class="piece-image-box">[Imagem aqui]</div>

            <div class="checklist-item-list" id="checklist-item-list"></div>

            <button class="btn-primary" id="finalizar-inspecao-btn" style="margin-top:20px;">
              Finalizar Inspe√ß√£o
            </button>

            <div class="checklist-nok-library" id="checklist-nok-library"></div>
          </div>

          <!-- Painel lateral da tela de Checklist -->
          <aside class="checklist-side">
            <div class="side-card" id="side-inspector-card">
              <div class="side-card-title">Inspetor</div>
              <div class="side-inspector-content">
                <div class="side-avatar" id="side-inspector-avatar"></div>
                <div>
                  <div id="side-inspector-name" class="side-inspector-name">‚Äî</div>
                  <div id="side-inspector-info" class="side-inspector-info">
                    Selecione um inspetor na tela inicial.
                  </div>
                </div>
              </div>
            </div>

            <div class="side-card" id="side-piece-card">
              <div class="side-card-title">Pe√ßa</div>
              <div class="side-piece-code" id="side-piece-code">‚Äî</div>
              <div class="side-piece-desc" id="side-piece-desc">
                Selecione pe√ßa na tela inicial.
              </div>
              <div class="side-piece-extra">
                <span id="side-piece-items">0 itens de inspe√ß√£o</span>
              </div>
            </div>

            <div class="side-card" id="side-status-card">
              <div class="side-card-title">Status da inspe√ß√£o</div>
              <div class="side-status-row">
                <span>Itens OK:</span>
                <span id="side-count-ok" class="badge badge-ok">0</span>
              </div>
              <div class="side-status-row">
                <span>Itens N√ÉO OK:</span>
                <span id="side-count-nok" class="badge badge-nok">0</span>
              </div>
              <div class="side-status-row">
                <span>Itens pendentes:</span>
                <span id="side-count-pend" class="badge badge-pend">0</span>
              </div>
            </div>
          </aside>
        </div>
      </div>

      <!-- Dashboard + Relat√≥rios -->
      <div id="reports" class="screen">
        <div class="report-header">Dashboard & Relat√≥rios</div>

        <div class="report-controls">
          <button class="report-csv-btn" onclick="exportCSV()">Exportar CSV</button>
          <div class="report-total-volume">
            Total (todas inspe√ß√µes):
            <span id="total-inspecoes" class="report-total-num">0</span>
          </div>
          <div>
            <label for="report-month-select" class="label-inline">Selecionar m√™s:</label>
            <select id="report-month-select"></select>
          </div>
        </div>

        <div class="section-title">Volume mensal</div>
        <div id="volume-mensal-box">
          <span id="volume-mensal-num">0</span> inspe√ß√µes
        </div>

        <div class="report-graph-area">
          <canvas id="graficoRosca" class="grafico-bola" width="140" height="140"></canvas>
          <div class="report-graph-legend">
            <div class="report-graph-legend-item">
              <span class="legend-color legend-ok"></span>
              <span>Embarcadas</span>
            </div>
            <div class="report-graph-legend-item">
              <span class="legend-color legend-retrabalho"></span>
              <span>Retrabalho</span>
            </div>
          </div>
        </div>

        <div class="section-title">Hist√≥rico (planilha)</div>
        <div class="report-history">
          <table class="report-history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Inspetor</th>
                <th>Pe√ßa</th>
                <th>Descri√ß√£o</th>
              </tr>
            </thead>
            <tbody id="reports-history-body"></tbody>
          </table>
        </div>
      </div>

      <!-- Admin: Pe√ßas & Itens + Inspetores -->
      <div id="admin" class="screen">
        <!-- Pe√ßas -->
        <div class="activity-block" id="admin-pieces-block">
          <div class="activity-header">Pe√ßas & Itens</div>
          <div id="piece-form-fields">
            <div class="form-group">
              <label for="new-code">C√≥digo (Ex: 597-2445#01)</label>
              <input type="text" id="new-code" placeholder="Ex: 597-2445#01">
            </div>
            <div class="form-group">
              <label for="new-description">Descri√ß√£o</label>
              <input type="text" id="new-description" placeholder="Longarina">
            </div>
            <div class="form-group">
              <label for="new-image">Imagem (obrigat√≥ria)</label>
              <input type="file" id="new-image" accept="image/*">
              <p class="file-info" id="image-file-info">Nenhum arquivo escolhido</p>
            </div>
          </div>
          <button class="btn-primary" id="add-piece-btn" style="margin-right:10px;">Adicionar pe√ßa</button>
          <button class="btn-secondary" id="clear-piece-btn">Limpar</button>

          <h4 class="section-subtitle" style="margin-top:20px;">Pe√ßas existentes</h4>
          <div class="admin-piece-list" id="admin-piece-list"></div>

          <hr style="margin:18px 0; border:none; border-top:1px solid #d0d7e8;">

          <div class="form-group">
            <label for="select-piece-item">Selecionar pe√ßa para itens</label>
            <select id="select-piece-item"></select>
          </div>

          <h5 class="section-subtitle">Itens atuais</h5>
          <div id="admin-piece-items-list"></div>

          <div id="item-form-fields">
            <div class="form-group">
              <label for="new-item-name">Novo item</label>
              <input type="text" id="new-item-name" placeholder="Dimens√£o X">
            </div>
            <div class="form-group">
              <label for="new-item-description">Descri√ß√£o do item (obrigat√≥ria)</label>
              <textarea id="new-item-description"></textarea>
            </div>
            <div class="form-group">
              <label for="new-item-image">Imagem do item (obrigat√≥ria)</label>
              <input type="file" id="new-item-image" accept="image/*">
              <p class="file-info" id="item-image-file-info">Nenhum arquivo escolhido</p>
            </div>
          </div>
          <button class="btn-primary" id="add-piece-item-btn">Adicionar item</button>
        </div>

        <!-- Inspetores -->
        <div class="activity-block" id="admin-inspectors-block">
          <div class="activity-header">Inspetores</div>

          <div class="form-group">
            <label for="inspector-new-name">Nome do inspetor</label>
            <input type="text" id="inspector-new-name" placeholder="Nome do inspetor">
          </div>

          <div class="admin-buttons-row">
            <button class="btn-primary" id="add-inspector-btn">Adicionar</button>
            <button class="btn-secondary" id="clear-inspector-btn">Limpar</button>
          </div>

          <h4 class="section-subtitle" style="margin-top:20px;">Inspetores cadastrados</h4>
          <div class="admin-inspector-list" id="admin-inspector-list"></div>
        </div>
      </div>

      <!-- Modal global -->
      <div id="modal-overlay" class="modal-overlay" style="display:none;">
        <div id="modal-box" class="modal-box"></div>
      </div>

    </div><!-- .container -->
  </div><!-- .app-wrapper -->
</div><!-- .app-shell -->

<!-- Firebase (j√° existe no seu reposit√≥rio) -->
<script type="module" src="firebase.js"></script>
<!-- L√≥gica da aplica√ß√£o -->
<script src="app.js"></script>
</body>
</html>
