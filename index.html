<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Magius - Sistema de Checklist de Inspe√ß√£o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js para gr√°ficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <!-- SIDEBAR LATERAL -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <div class="sidebar-logo-mark">M</div>
        <div class="sidebar-logo-text">
          <div class="sidebar-logo-main">MAGIUS</div>
          <div class="sidebar-logo-sub">Checklist de Inspe√ß√£o</div>
        </div>
      </div>

      <nav class="sidebar-menu">
        <button class="sidebar-item active" data-screen="checklist" onclick="selectSidebar('checklist')">
          <span class="sidebar-icon">‚úÖ</span>
          <span class="sidebar-label">Checklist</span>
        </button>

        <button class="sidebar-item" data-screen="inspectors" onclick="selectSidebar('inspectors')">
          <span class="sidebar-icon">üë§</span>
          <span class="sidebar-label">Inspetores</span>
        </button>

        <button class="sidebar-item" data-screen="pieces" onclick="selectSidebar('pieces')">
          <span class="sidebar-icon">üß©</span>
          <span class="sidebar-label">Pe√ßas & Itens</span>
        </button>

        <button class="sidebar-item" data-screen="dashboard" onclick="selectSidebar('dashboard')">
          <span class="sidebar-icon">üìä</span>
          <span class="sidebar-label">Dashboard</span>
        </button>

        <button class="sidebar-item" data-screen="reports" onclick="selectSidebar('reports')">
          <span class="sidebar-icon">üìë</span>
          <span class="sidebar-label">Relat√≥rios</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="sidebar-tagline">
          AJUDANDO A CONSTRUIR, CULTIVAR,<br>
          TRANSPORTAR E SEGUIR EM FRENTE
        </div>
      </div>
    </aside>

    <!-- √ÅREA PRINCIPAL -->
    <main class="main-area">
      <!-- HEADER SUPERIOR -->
      <header class="top-header">
        <div class="top-header-left">
          <h1>MAGIUS ‚Äì Sistema de Checklist de Inspe√ß√£o</h1>
        </div>
        <div class="top-header-right">
          <span class="top-badge">Metal√∫rgica Industrial</span>
        </div>
      </header>

      <!-- TELAS (P√ÅGINAS) -->

      <!-- 1) CHECKLIST -->
      <section id="checklist" class="screen active">
        <div class="page-header">Checklist de Inspe√ß√£o</div>

        <div class="checklist-layout">
          <!-- Painel de sele√ß√£o -->
          <div class="card checklist-form-panel">
            <h2 class="card-title">Sele√ß√£o</h2>
            <div class="form-group">
              <label for="inspector-select">Inspetor:</label>
              <select id="inspector-select">
                <option value="" disabled selected>Selecionar inspetor</option>
              </select>
            </div>

            <div class="form-group">
              <label for="piece-select">Pe√ßa:</label>
              <select id="piece-select">
                <option value="" disabled selected>Selecionar pe√ßa</option>
              </select>
            </div>

            <button class="btn-primary full" id="btn-carregar-checklist">
              Carregar checklist
            </button>
          </div>

          <!-- Painel de execu√ß√£o -->
          <div class="card checklist-exec-panel">
            <div class="checklist-piece-title" id="checklist-header"></div>

            <div id="piece-image-box" class="piece-image-box">
              [Selecione uma pe√ßa para carregar o checklist]
            </div>

            <div id="checklist-item-list"></div>

            <button class="btn-primary" id="finalizar-inspecao-btn" style="margin-top:20px;">
              Finalizar Inspe√ß√£o
            </button>

            <div id="checklist-nok-library" class="checklist-nok-library"></div>
          </div>
        </div>
      </section>

      <!-- 2) INSPETORES -->
      <section id="inspectors" class="screen">
        <div class="page-header">Cadastro de Inspetores</div>

        <div class="card">
          <h2 class="card-title">Novo Inspetor</h2>
          <div class="inspectors-form-row">
            <div class="form-group">
              <label for="inspector-new-name">Nome do inspetor</label>
              <input type="text" id="inspector-new-name" placeholder="Nome completo">
            </div>
            <div class="form-group">
              <label for="inspector-photo-input">Foto</label>
              <input type="file" id="inspector-photo-input" accept="image/*">
            </div>
          </div>
          <div class="inspectors-form-actions">
            <button class="btn-primary" id="add-inspector-btn">Adicionar</button>
            <button class="btn-secondary" id="clear-inspector-btn">Limpar</button>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">Inspetores cadastrados</h2>
          <div class="admin-inspector-list" id="admin-inspector-list"></div>
        </div>
      </section>

      <!-- 3) PE√áAS & ITENS -->
      <section id="pieces" class="screen">
        <div class="page-header">Cadastro de Pe√ßas & Itens de Checklist</div>

        <div class="cards-grid-2">
          <!-- Pe√ßa -->
          <div class="card">
            <h2 class="card-title">Nova Pe√ßa</h2>
            <div class="form-group">
              <label for="new-code">C√≥digo (Ex: 597-2445#01)</label>
              <input type="text" id="new-code" placeholder="Ex: 597-2445#01">
            </div>
            <div class="form-group">
              <label for="new-description">Descri√ß√£o</label>
              <input type="text" id="new-description" placeholder="Longarina">
            </div>
            <div class="form-group">
              <label for="new-image">Imagem (obrigat√≥ria)</label>
              <input type="file" id="new-image" accept="image/*">
              <p class="file-info" id="image-file-info">Nenhum arquivo escolhido</p>
            </div>

            <div class="form-actions">
              <button class="btn-primary" id="add-piece-btn">Adicionar pe√ßa</button>
              <button class="btn-secondary" id="clear-piece-btn">Limpar</button>
            </div>

            <h3 class="card-subtitle">Pe√ßas existentes</h3>
            <div class="admin-piece-list" id="admin-piece-list"></div>
          </div>

          <!-- Itens da pe√ßa -->
          <div class="card">
            <h2 class="card-title">Itens do Checklist da Pe√ßa</h2>

            <div class="form-group">
              <label for="select-piece-item">Selecionar pe√ßa</label>
              <select id="select-piece-item"></select>
            </div>

            <h3 class="card-subtitle">Itens atuais</h3>
            <div id="admin-piece-items-list"></div>

            <h3 class="card-subtitle" style="margin-top:20px;">Novo item</h3>
            <div class="form-group">
              <label for="new-item-name">Nome do item</label>
              <input type="text" id="new-item-name" placeholder="Ex: Dimens√£o √ò 7,3 mm">
            </div>
            <div class="form-group">
              <label for="new-item-description">Descri√ß√£o do item (obrigat√≥ria)</label>
              <textarea id="new-item-description" rows="3"
                        placeholder="Ex: Verificar di√¢metro da fura√ß√£o conforme desenho."></textarea>
            </div>
            <div class="form-group">
              <label for="new-item-image">Imagem do item (obrigat√≥ria)</label>
              <input type="file" id="new-item-image" accept="image/*">
              <p class="file-info" id="item-image-file-info">Nenhum arquivo escolhido</p>
            </div>

            <button class="btn-primary" id="add-piece-item-btn">Adicionar item</button>
          </div>
        </div>
      </section>

      <!-- 4) DASHBOARD / KPIs -->
      <section id="dashboard" class="screen">
        <div class="page-header">Dashboard ‚Äì KPIs de Inspe√ß√£o</div>

        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-label">Inspe√ß√µes no m√™s</div>
            <div class="kpi-value" id="kpi-inspecoes-mes">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">% Itens N√ÉO OK</div>
            <div class="kpi-value" id="kpi-percent-nok">0%</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Pe√ßas com mais NOK</div>
            <div class="kpi-list" id="kpi-top-pecas"></div>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">Distribui√ß√£o de Encaminhamento (M√™s)</h2>
          <div class="report-graph-area">
            <canvas id="graficoDashboard" class="grafico-bola" width="160" height="160"></canvas>
          </div>
        </div>
      </section>

      <!-- 5) RELAT√ìRIOS -->
      <section id="reports" class="screen">
        <div class="page-header">Relat√≥rios</div>

        <div class="card">
          <div class="report-controls">
            <button class="report-csv-btn" onclick="exportCSV()">Exportar CSV</button>
            <div class="report-total-volume">
              Total (todas inspe√ß√µes): <span id="total-inspecoes">0</span>
            </div>
            <div>
              <label for="report-month-select" class="label-inline">Selecionar m√™s:</label>
              <select id="report-month-select"></select>
            </div>
          </div>

          <div class="report-section-title">Volume mensal</div>
          <div id="volume-mensal-box">
            <span id="volume-mensal-num">0</span> inspe√ß√µes
          </div>

          <div class="report-graph-area">
            <canvas id="graficoRosca" class="grafico-bola" width="140" height="140"></canvas>
            <div class="report-graph-legend">
              <div class="report-graph-legend-item">
                <span class="legend-color legend-embarcadas"></span>
                <span>Embarcadas</span>
              </div>
              <div class="report-graph-legend-item">
                <span class="legend-color legend-retrabalho"></span>
                <span>Retrabalho</span>
              </div>
            </div>
          </div>

          <div class="report-section-title">Hist√≥rico</div>
          <table class="report-history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Inspetor</th>
                <th>Pe√ßa</th>
                <th>Descri√ß√£o</th>
              </tr>
            </thead>
            <tbody id="reports-history-body"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL GEN√âRICO -->
  <div id="modal-overlay" class="modal-overlay" style="display:none;">
    <div id="modal-box" class="modal-box"></div>
  </div>

  <!-- Firebase (an√¥nimo) exp√µe window.fbApi -->
  <script type="module" src="firebase.js"></script>
  <!-- L√≥gica principal da aplica√ß√£o -->
  <script src="app.js"></script>
</body>
</html>
